(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[812],{283:(e,t,r)=>{"use strict";r.d(t,{A:()=>i}),r(5155);var s=r(2115);r(9323),r(6104);let a=(0,s.createContext)({user:null,userRole:null,loading:!0,isAdmin:!1,error:null}),i=()=>{let e=(0,s.useContext)(a);if(!e)throw Error("useAuth must be used within an AuthProvider");return e}},570:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>z});var s=r(5155),a=r(2115),i=r(2657),n=r(7924),l=r(9946);let o=(0,l.A)("upload",[["path",{d:"M12 3v12",key:"1x0j5s"}],["path",{d:"m17 8-5-5-5 5",key:"7q97r8"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}]]);var c=r(2525),d=r(5317),u=r(6104);let m=async function(e){let t,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:3,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1e3;for(let a=0;a<=r;a++)try{return await e()}catch(i){if(t=i,a===r)throw t;let e=s*Math.pow(2,a);await new Promise(t=>setTimeout(t,e))}throw t},h=!0,p="mirror_beauty_customers_cache",x="mirror_beauty_customers_cache_timestamp",f="customers",g=async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:50,r=arguments.length>2?arguments[2]:void 0;try{if(!(0,u.Gg)()||!u.db)return{success:!1,error:"Firebase is not configured. Please set up your Firebase environment variables."};if(!(h&&navigator.onLine))return{success:!1,error:"No network connection available"};let a=async()=>{let s=(0,d.P)((0,d.rJ)(u.db,f),(0,d.My)("createdAt","desc"));(null==e?void 0:e.status)&&"all"!==e.status&&(s=(0,d.P)(s,(0,d._M)("status","==",e.status))),(null==e?void 0:e.membershipTier)&&"all"!==e.membershipTier&&(s=(0,d.P)(s,(0,d._M)("membershipTier","==",e.membershipTier))),(null==e?void 0:e.branch)&&(s=(0,d.P)(s,(0,d._M)("preferences.preferredBranch","==",e.branch))),s=(0,d.P)(s,(0,d.AB)(t)),r&&(s=(0,d.P)(s,(0,d.HM)(r)));let a=await (0,d.GG)(s),i=[];return a.forEach(e=>{var t,r,s,a,n;let l=e.data();i.push({id:e.id,...l,createdAt:(null==(t=l.createdAt)?void 0:t.toDate())||new Date,updatedAt:(null==(r=l.updatedAt)?void 0:r.toDate())||new Date,dateOfBirth:null==(s=l.dateOfBirth)?void 0:s.toDate(),visitHistory:{...l.visitHistory,lastVisit:null==(n=l.visitHistory)||null==(a=n.lastVisit)?void 0:a.toDate()}})}),{customers:i,lastDoc:a.docs[a.docs.length-1],hasMore:a.docs.length===t}},i=await m(a,2,1e3);var s=i.customers;try{let e={customers:s,timestamp:Date.now()};localStorage.setItem(p,JSON.stringify(e)),localStorage.setItem(x,Date.now().toString())}catch(e){console.warn("Failed to save customers to cache")}return{success:!0,data:i}}catch(t){console.error("Error getting customers:",t),(e=>{var t,r;if(!e)return!1;let s=(null==(t=e.message)?void 0:t.toLowerCase())||"",a=(null==(r=e.code)?void 0:r.toLowerCase())||"";return s.includes("network")||s.includes("fetch")||s.includes("connection")||s.includes("timeout")||a.includes("unavailable")||a.includes("deadline-exceeded")||a.includes("network-error")})(t)&&(h=!1);let e=(()=>{try{let e=localStorage.getItem(p),t=localStorage.getItem(x);if(!e||!t)return null;if(Date.now()-parseInt(t)>3e5)return(()=>{try{localStorage.removeItem(p),localStorage.removeItem(x)}catch(e){console.warn("Failed to clear customers cache")}})(),null;return JSON.parse(e).customers.map(e=>{var t;return{...e,createdAt:new Date(e.createdAt),updatedAt:new Date(e.updatedAt),dateOfBirth:e.dateOfBirth?new Date(e.dateOfBirth):void 0,visitHistory:{...e.visitHistory,lastVisit:(null==(t=e.visitHistory)?void 0:t.lastVisit)?new Date(e.visitHistory.lastVisit):void 0}}})}catch(e){return console.warn("Failed to load customers from cache"),null}})();if(e)return console.warn("Using cached customer data due to connection issues"),{success:!0,data:{customers:e,lastDoc:void 0,hasMore:!1}};return{success:!1,error:t instanceof Error?t.message:"Failed to get customers"}}},y=async e=>{try{if(!(0,u.Gg)()||!u.db)return{success:!1,error:"Firebase is not configured. Please set up your Firebase environment variables."};let t=[],r=(0,d.P)((0,d.rJ)(u.db,f),(0,d._M)("name",">=",e),(0,d._M)("name","<=",e+""),(0,d.AB)(20));(await (0,d.GG)(r)).forEach(e=>{var r,s,a,i,n;let l=e.data();t.push({id:e.id,...l,createdAt:(null==(r=l.createdAt)?void 0:r.toDate())||new Date,updatedAt:(null==(s=l.updatedAt)?void 0:s.toDate())||new Date,dateOfBirth:null==(a=l.dateOfBirth)?void 0:a.toDate(),visitHistory:{...l.visitHistory,lastVisit:null==(n=l.visitHistory)||null==(i=n.lastVisit)?void 0:i.toDate()}})});let s=(0,d.P)((0,d.rJ)(u.db,f),(0,d._M)("email",">=",e),(0,d._M)("email","<=",e+""),(0,d.AB)(20));return(await (0,d.GG)(s)).forEach(e=>{var r,s,a,i,n;let l=e.data(),o={id:e.id,...l,createdAt:(null==(r=l.createdAt)?void 0:r.toDate())||new Date,updatedAt:(null==(s=l.updatedAt)?void 0:s.toDate())||new Date,dateOfBirth:null==(a=l.dateOfBirth)?void 0:a.toDate(),visitHistory:{...l.visitHistory,lastVisit:null==(n=l.visitHistory)||null==(i=n.lastVisit)?void 0:i.toDate()}};t.find(e=>e.id===o.id)||t.push(o)}),{success:!0,data:t}}catch(e){return console.error("Error searching customers:",e),{success:!1,error:e instanceof Error?e.message:"Failed to search customers"}}},v=async e=>{try{let t=d.Dc.now(),r={...e,dateOfBirth:e.dateOfBirth?d.Dc.fromDate(new Date(e.dateOfBirth)):null,visitHistory:{totalVisits:0,totalSpent:0,favoriteServices:[]},loyaltyPoints:0,membershipTier:"bronze",status:"active",tags:e.tags?e.tags.split(",").map(e=>e.trim()):[],createdAt:t,updatedAt:t};Object.keys(r).forEach(e=>{void 0===r[e]&&delete r[e]});let s=await (0,d.gS)((0,d.rJ)(u.db,f),r);return{success:!0,data:s.id}}catch(e){return console.error("Error creating customer:",e),{success:!1,error:e instanceof Error?e.message:"Failed to create customer"}}},w=async e=>{try{if(!e)return{success:!1,error:"Customer ID is required"};let t=(0,d.H9)(u.db,f,e);return await (0,d.kd)(t),{success:!0,data:void 0}}catch(e){return console.error("Error deleting customer:",e),{success:!1,error:e instanceof Error?e.message:"Failed to delete customer"}}},b=async()=>{try{let e=(0,d.P)((0,d.rJ)(u.db,f)),t=await (0,d.GG)(e),r=(0,d.P)((0,d.rJ)(u.db,f),(0,d._M)("status","==","active")),s=await (0,d.GG)(r),a=new Date;a.setDate(1),a.setHours(0,0,0,0);let i=(0,d.P)((0,d.rJ)(u.db,f),(0,d._M)("createdAt",">=",d.Dc.fromDate(a))),n=await (0,d.GG)(i),l=(0,d.P)((0,d.rJ)(u.db,f),(0,d.My)("visitHistory.totalSpent","desc"),(0,d.AB)(5)),o=await (0,d.GG)(l),c=[];o.forEach(e=>{var t,r,s,a,i;let n=e.data();c.push({id:e.id,...n,createdAt:(null==(t=n.createdAt)?void 0:t.toDate())||new Date,updatedAt:(null==(r=n.updatedAt)?void 0:r.toDate())||new Date,dateOfBirth:null==(s=n.dateOfBirth)?void 0:s.toDate(),visitHistory:{...n.visitHistory,lastVisit:null==(i=n.visitHistory)||null==(a=i.lastVisit)?void 0:a.toDate()}})});let m={bronze:0,silver:0,gold:0,platinum:0};t.forEach(e=>{let t=e.data().membershipTier||"bronze";m[t]++});let h={totalCustomers:t.size,activeCustomers:s.size,newCustomersThisMonth:n.size,topSpenders:c,membershipDistribution:m};return{success:!0,data:h}}catch(e){return console.error("Error getting customer stats:",e),{success:!1,error:e instanceof Error?e.message:"Failed to get customer statistics"}}},j=async e=>{try{let t=0,r=0,s=[],a=[];for(let i=0;i<e.length;i++){let n=e[i];try{let e=await v(n);t++,a.push({customerId:e.data,customer:n,row:i+1})}catch(t){r++;let e=t instanceof Error?t.message:"Unknown error";s.push("Row ".concat(i+1,": ").concat(e)),a.push({error:e,customer:n,row:i+1})}}return{successful:t,failed:r,errors:s,data:a}}catch(e){throw console.error("Error bulk importing customers:",e),e}};var N=r(283);let k=(0,l.A)("x",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]]),A=(0,l.A)("download",[["path",{d:"M12 15V3",key:"m9g1x1"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["path",{d:"m7 10 5 5 5-5",key:"brsn70"}]]),C=(0,l.A)("file-spreadsheet",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M8 13h2",key:"yr2amv"}],["path",{d:"M14 13h2",key:"un5t4a"}],["path",{d:"M8 17h2",key:"2yhykz"}],["path",{d:"M14 17h2",key:"10kma7"}]]);var D=r(646),S=r(5339),E=r(3925);let _=async e=>new Promise((t,r)=>{let s=new FileReader;s.onload=s=>{try{var a;let r,i=null==(a=s.target)?void 0:a.result,n=(r=e.name.endsWith(".csv")?E.LF(i,{type:"binary"}):E.LF(i,{type:"array"})).SheetNames[0],l=r.Sheets[n],o=E.Wp.sheet_to_json(l,{header:1}),c=M(o);t(c)}catch(e){r(Error("Failed to parse file"))}},s.onerror=()=>r(Error("Failed to read file")),e.name.endsWith(".csv")?s.readAsBinaryString(e):s.readAsArrayBuffer(e)}),M=e=>{if(0===e.length)return[];let t=e[0].map(e=>String(e).toLowerCase().trim().replace(/\s+/g,"_")),r=[];for(let s=1;s<e.length;s++){let a=e[s];if(a&&0!==a.length)try{let e=I(t,a);e.name&&e.email&&r.push(e)}catch(e){console.warn("Error parsing row ".concat(s+1))}}return r},I=(e,t)=>{var r,s,a,i,n,l,o,c;let d=r=>{for(let s of r){let r=e.findIndex(e=>e.includes(s));if(-1!==r&&t[r])return String(t[r]).trim()}return""},u=e=>["yes","true","1","y","on"].includes(d(e).toLowerCase()),m={name:d(["name","customer_name","full_name","client_name"]),email:d(["email","email_address","e_mail"]),phone:d(["phone","phone_number","mobile","contact","telephone"]),dateOfBirth:(e=>{let t=d(e);if(!t)return"";try{if(!isNaN(Number(t))&&Number(t)>25e3){let e=E.tF.parse_date_code(Number(t));return"".concat(e.y,"-").concat(String(e.m).padStart(2,"0"),"-").concat(String(e.d).padStart(2,"0"))}let e=new Date(t);if(!isNaN(e.getTime()))return e.toISOString().split("T")[0]}catch(e){console.warn("Error parsing date:",t)}return""})(["date_of_birth","dob","birth_date","birthday"]),gender:d(["gender","sex"]),address:{street:d(["address","street","street_address","address_line_1"]),city:d(["city","town"]),state:d(["state","province","region"]),zipCode:d(["zip","zip_code","postal_code","postcode"])},preferences:{preferredBranch:d(["branch","preferred_branch","location"]),allergies:d(["allergies","allergy","medical_notes"]),skinType:d(["skin_type","skin"])||"normal",notes:d(["notes","comments","remarks","additional_info"])},marketingConsent:{email:u(["email_marketing","email_consent","marketing_email"]),sms:u(["sms_marketing","sms_consent","text_marketing"]),phone:u(["phone_marketing","call_consent","phone_consent"])},tags:d(["tags","categories","labels"])};return(null==(r=m.address)?void 0:r.street)||(null==(s=m.address)?void 0:s.city)||(null==(a=m.address)?void 0:a.state)||(null==(i=m.address)?void 0:i.zipCode)||(m.address=void 0),(null==(n=m.preferences)?void 0:n.preferredBranch)||(null==(l=m.preferences)?void 0:l.allergies)||(null==(o=m.preferences)?void 0:o.notes)||(m.preferences={skinType:(null==(c=m.preferences)?void 0:c.skinType)||"normal"}),m},P=async e=>{try{let t=await _(e);if(0===t.length)return{success:!1,totalRows:0,successfulImports:0,failedImports:0,errors:[{row:0,error:"No valid customer data found in file"}]};let r=await j(t),s=r.successful,a=r.failed,i=r.errors.map((e,r)=>{let s=e.match(/Row (\d+):/),a=s?parseInt(s[1]):r+2,i=e.replace(/Row \d+: /,"");return{row:a,error:i,data:t[a-2]}});return{success:0===a,totalRows:t.length,successfulImports:s,failedImports:a,errors:i}}catch(e){return{success:!1,totalRows:0,successfulImports:0,failedImports:0,errors:[{row:0,error:e instanceof Error?e.message:"Unknown error occurred"}]}}},B=()=>{let e=new Blob([[["Name","Email","Phone","Date of Birth","Gender","Street Address","City","State","ZIP Code","Preferred Branch","Allergies","Skin Type","Notes","Email Marketing","SMS Marketing","Phone Marketing","Tags"],["Jane Smith","jane.smith@email.com","+1-555-0123","1990-05-15","female","123 Beauty Lane","Los Angeles","CA","90210","Downtown Branch","None","combination","Prefers evening appointments","yes","no","yes","VIP, Regular"],["John Doe","john.doe@email.com","+1-555-0124","1985-12-03","male","456 Salon Street","Beverly Hills","CA","90211","Beverly Hills Branch","Sensitive to fragrances","sensitive","First-time customer","yes","yes","no","New Customer"]].map(e=>e.map(e=>'"'.concat(e,'"')).join(",")).join("\n")],{type:"text/csv;charset=utf-8;"}),t=document.createElement("a");if(void 0!==t.download){let r=URL.createObjectURL(e);t.setAttribute("href",r),t.setAttribute("download","customer_import_template.csv"),t.style.visibility="hidden",document.body.appendChild(t),t.click(),document.body.removeChild(t)}};function F(e){let{onImportComplete:t,onClose:r}=e,[i,n]=(0,a.useState)(null),[l,c]=(0,a.useState)(!1),[d,u]=(0,a.useState)(null),[m,h]=(0,a.useState)(!1),p=(0,a.useRef)(null),x=e=>{e.preventDefault(),e.stopPropagation(),"dragenter"===e.type||"dragover"===e.type?h(!0):"dragleave"===e.type&&h(!1)},f=e=>{let t=(e=>{let t=["application/vnd.ms-excel","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet","text/csv","application/csv"].includes(e.type),r=[".xlsx",".xls",".csv"].some(t=>e.name.toLowerCase().endsWith(t));return t||r?e.size>0xa00000?{valid:!1,error:"File size must be less than 10MB"}:{valid:!0}:{valid:!1,error:"Please upload a valid Excel (.xlsx, .xls) or CSV (.csv) file"}})(e);if(!t.valid)return void alert(t.error);n(e),u(null)},g=async()=>{if(i){c(!0);try{let e=await P(i);u(e),e.success&&e.successfulImports>0&&(null==t||t(e))}catch(e){console.error("Import error:",e),u({success:!1,totalRows:0,successfulImports:0,failedImports:0,errors:[{row:0,error:"Failed to import file"}]})}finally{c(!1)}}},y=()=>{n(null),u(null),p.current&&(p.current.value="")};return(0,s.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:(0,s.jsxs)("div",{className:"bg-white rounded-lg p-6 w-full max-w-2xl mx-4 max-h-[90vh] overflow-y-auto",children:[(0,s.jsxs)("div",{className:"flex justify-between items-center mb-6",children:[(0,s.jsx)("h2",{className:"text-2xl font-bold text-gray-900",children:"Import Customer Data"}),(0,s.jsx)("button",{onClick:r,className:"text-gray-400 hover:text-gray-600 transition-colors",children:(0,s.jsx)(k,{className:"w-6 h-6"})})]}),d?(0,s.jsxs)("div",{className:"space-y-6",children:[(0,s.jsxs)("div",{className:"p-4 rounded-lg border ".concat(d.success?"bg-green-50 border-green-200":"bg-red-50 border-red-200"),children:[(0,s.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[d.success?(0,s.jsx)(D.A,{className:"w-5 h-5 text-green-600"}):(0,s.jsx)(S.A,{className:"w-5 h-5 text-red-600"}),(0,s.jsx)("h3",{className:"font-semibold ".concat(d.success?"text-green-900":"text-red-900"),children:d.success?"Import Completed Successfully":"Import Completed with Errors"})]}),(0,s.jsxs)("div",{className:"grid grid-cols-3 gap-4 text-sm",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("span",{className:"font-medium",children:"Total Rows:"}),(0,s.jsx)("span",{className:"ml-2",children:d.totalRows})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("span",{className:"font-medium text-green-700",children:"Successful:"}),(0,s.jsx)("span",{className:"ml-2",children:d.successfulImports})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("span",{className:"font-medium text-red-700",children:"Failed:"}),(0,s.jsx)("span",{className:"ml-2",children:d.failedImports})]})]})]}),d.errors.length>0&&(0,s.jsxs)("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4",children:[(0,s.jsx)("h4",{className:"font-semibold text-red-900 mb-3",children:"Import Errors"}),(0,s.jsx)("div",{className:"max-h-60 overflow-y-auto space-y-2",children:d.errors.map((e,t)=>(0,s.jsxs)("div",{className:"text-sm",children:[(0,s.jsxs)("span",{className:"font-medium text-red-800",children:["Row ",e.row,":"]}),(0,s.jsx)("span",{className:"ml-2 text-red-700",children:e.error})]},t))})]}),(0,s.jsxs)("div",{className:"flex justify-end gap-3",children:[(0,s.jsx)("button",{onClick:y,className:"px-6 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors",children:"Import Another File"}),(0,s.jsx)("button",{onClick:r,className:"px-6 py-2 bg-pink-600 text-white rounded-lg hover:bg-pink-700 transition-colors",children:"Close"})]})]}):(0,s.jsxs)("div",{className:"space-y-6",children:[(0,s.jsxs)("div",{className:"bg-pink-50 border border-pink-200 rounded-lg p-4",children:[(0,s.jsx)("h3",{className:"font-semibold text-pink-900 mb-2",children:"Import Instructions"}),(0,s.jsxs)("ul",{className:"text-sm text-pink-800 space-y-1",children:[(0,s.jsx)("li",{children:"• Supported formats: Excel (.xlsx, .xls) and CSV (.csv)"}),(0,s.jsx)("li",{children:"• Maximum file size: 10MB"}),(0,s.jsx)("li",{children:"• First row should contain column headers"}),(0,s.jsx)("li",{children:"• Required fields: Name, Email"}),(0,s.jsx)("li",{children:"• Optional fields: Phone, Address, Preferences, etc."})]})]}),(0,s.jsxs)("div",{className:"flex justify-between items-center p-4 bg-gray-50 rounded-lg",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("h4",{className:"font-medium text-gray-900",children:"Need a template?"}),(0,s.jsx)("p",{className:"text-sm text-gray-600",children:"Download our sample CSV file to see the expected format"})]}),(0,s.jsxs)("button",{onClick:B,className:"flex items-center gap-2 px-4 py-2 bg-pink-600 text-white rounded-lg hover:bg-pink-700 transition-colors",children:[(0,s.jsx)(A,{className:"w-4 h-4"}),"Download Template"]})]}),(0,s.jsxs)("div",{className:"border-2 border-dashed rounded-lg p-8 text-center transition-colors ".concat(m?"border-pink-400 bg-pink-50":i?"border-green-400 bg-green-50":"border-gray-300 hover:border-pink-400"),onDragEnter:x,onDragLeave:x,onDragOver:x,onDrop:e=>{e.preventDefault(),e.stopPropagation(),h(!1),e.dataTransfer.files&&e.dataTransfer.files[0]&&f(e.dataTransfer.files[0])},children:[(0,s.jsx)("input",{ref:p,type:"file",accept:".xlsx,.xls,.csv",onChange:e=>{e.target.files&&e.target.files[0]&&f(e.target.files[0])},className:"hidden"}),i?(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)(C,{className:"w-12 h-12 text-green-600 mx-auto"}),(0,s.jsx)("p",{className:"font-medium text-green-900",children:i.name}),(0,s.jsxs)("p",{className:"text-sm text-green-700",children:[(i.size/1024/1024).toFixed(2)," MB"]}),(0,s.jsx)("button",{onClick:y,className:"text-sm text-pink-600 hover:text-pink-700 underline",children:"Choose different file"})]}):(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)(o,{className:"w-12 h-12 text-gray-400 mx-auto"}),(0,s.jsxs)("p",{className:"text-lg font-medium text-gray-900",children:["Drop your file here or"," ",(0,s.jsx)("button",{onClick:()=>{var e;return null==(e=p.current)?void 0:e.click()},className:"text-pink-600 hover:text-pink-700 underline",children:"browse"})]}),(0,s.jsx)("p",{className:"text-sm text-gray-500",children:"Supports Excel (.xlsx, .xls) and CSV (.csv) files"})]})]}),i&&(0,s.jsxs)("div",{className:"flex justify-end gap-3",children:[(0,s.jsx)("button",{onClick:y,className:"px-6 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors",children:"Cancel"}),(0,s.jsx)("button",{onClick:g,disabled:l,className:"px-6 py-2 bg-pink-600 text-white rounded-lg hover:bg-pink-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors flex items-center gap-2",children:l?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"}),"Importing..."]}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(o,{className:"w-4 h-4"}),"Import Data"]})})]})]})]})})}function z(){let{user:e}=(0,N.A)(),[t,r]=(0,a.useState)([]),[l,d]=(0,a.useState)([]),[u,m]=(0,a.useState)(!0),[h,p]=(0,a.useState)(""),[x]=(0,a.useState)({status:"all"}),[f,v]=(0,a.useState)(!1),[j,k]=(0,a.useState)({totalCustomers:0,activeCustomers:0,newCustomersThisMonth:0,topSpenders:[],membershipDistribution:{bronze:0,silver:0,gold:0,platinum:0}}),A=(0,a.useCallback)(async()=>{m(!0);try{let e=await g(x);e.success&&e.data?(r(e.data.customers),d(e.data.customers),setUsingCachedData(e.fromCache||!1)):console.error("Failed to fetch customers:",e.error)}catch(e){console.error("Error fetching customers:",e)}finally{m(!1)}},[x]),C=(0,a.useCallback)(async()=>{try{let e=await b();e.success&&e.data?k(e.data):console.error("Failed to fetch stats:",e.error)}catch(e){console.error("Error fetching stats:",e)}},[]),D=async e=>{if(p(e),!e.trim())return void d(t);try{let r=await y(e);if(r.success&&r.data)d(r.data);else{let r=t.filter(t=>t.name.toLowerCase().includes(e.toLowerCase())||t.email.toLowerCase().includes(e.toLowerCase())||t.phone.includes(e));d(r)}}catch(r){console.error("Error searching customers:",r),d(t.filter(t=>t.name.toLowerCase().includes(e.toLowerCase())||t.email.toLowerCase().includes(e.toLowerCase())||t.phone.includes(e)))}},S=async e=>{if(confirm("Are you sure you want to delete this customer?"))try{let t=await w(e);t.success?(A(),C()):console.error("Failed to delete customer:",t.error)}catch(e){console.error("Error deleting customer:",e)}};return((0,a.useEffect)(()=>{A(),C()},[x,A,C]),e)?(0,s.jsxs)("div",{className:"min-h-screen bg-gradient-to-br from-pink-50 to-rose-100 p-4",children:[(0,s.jsxs)("div",{className:"max-w-7xl mx-auto",children:[(0,s.jsxs)("div",{className:"mb-8",children:[(0,s.jsx)("h1",{className:"text-4xl font-bold text-gray-900 mb-2",children:"Customer Management"}),(0,s.jsx)("p",{className:"text-gray-600",children:"Manage your beauty salon customers"})]}),(0,s.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6 mb-8",children:[(0,s.jsx)("div",{className:"bg-white rounded-xl shadow-sm p-6",children:(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-sm font-medium text-gray-600",children:"Total Customers"}),(0,s.jsx)("p",{className:"text-2xl font-bold text-gray-900",children:j.totalCustomers})]}),(0,s.jsx)("div",{className:"h-12 w-12 bg-pink-100 rounded-lg flex items-center justify-center",children:(0,s.jsx)(i.A,{className:"h-6 w-6 text-pink-600"})})]})}),(0,s.jsx)("div",{className:"bg-white rounded-xl shadow-sm p-6",children:(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-sm font-medium text-gray-600",children:"Active"}),(0,s.jsx)("p",{className:"text-2xl font-bold text-green-600",children:j.activeCustomers})]}),(0,s.jsx)("div",{className:"h-12 w-12 bg-green-100 rounded-lg flex items-center justify-center",children:(0,s.jsx)(i.A,{className:"h-6 w-6 text-green-600"})})]})}),(0,s.jsx)("div",{className:"bg-white rounded-xl shadow-sm p-6",children:(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-sm font-medium text-gray-600",children:"New This Month"}),(0,s.jsx)("p",{className:"text-2xl font-bold text-blue-600",children:j.newCustomersThisMonth})]}),(0,s.jsx)("div",{className:"h-12 w-12 bg-gray-100 rounded-lg flex items-center justify-center",children:(0,s.jsx)(i.A,{className:"h-6 w-6 text-gray-500"})})]})}),(0,s.jsx)("div",{className:"bg-white rounded-xl shadow-sm p-6",children:(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-sm font-medium text-gray-600",children:"Platinum Members"}),(0,s.jsx)("p",{className:"text-2xl font-bold text-purple-600",children:j.membershipDistribution.platinum})]}),(0,s.jsx)("div",{className:"h-12 w-12 bg-purple-100 rounded-lg flex items-center justify-center",children:(0,s.jsx)(i.A,{className:"h-6 w-6 text-purple-600"})})]})})]}),(0,s.jsx)("div",{className:"bg-white rounded-xl shadow-sm p-6 mb-8",children:(0,s.jsxs)("div",{className:"flex flex-col sm:flex-row gap-4 items-center justify-between",children:[(0,s.jsx)("div",{className:"flex-1 max-w-md",children:(0,s.jsxs)("div",{className:"relative",children:[(0,s.jsx)(n.A,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 h-5 w-5"}),(0,s.jsx)("input",{type:"text",placeholder:"Search customers...",value:h,onChange:e=>D(e.target.value),className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-pink-500 focus:border-transparent"})]})}),(0,s.jsx)("div",{className:"flex gap-3",children:(0,s.jsxs)("button",{onClick:()=>v(!0),className:"flex items-center gap-2 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:[(0,s.jsx)(o,{className:"h-4 w-4"}),"Import"]})})]})}),(0,s.jsx)("div",{className:"bg-white rounded-xl shadow-sm overflow-hidden",children:(0,s.jsx)("div",{className:"overflow-x-auto",children:(0,s.jsxs)("table",{className:"w-full",children:[(0,s.jsx)("thead",{className:"bg-gray-50",children:(0,s.jsxs)("tr",{children:[(0,s.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Customer"}),(0,s.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Contact"}),(0,s.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Actions"})]})}),(0,s.jsx)("tbody",{className:"bg-white divide-y divide-gray-200",children:u?(0,s.jsx)("tr",{children:(0,s.jsx)("td",{colSpan:3,className:"px-6 py-4 text-center text-gray-500",children:"Loading customers..."})}):0===l.length?(0,s.jsx)("tr",{children:(0,s.jsx)("td",{colSpan:3,className:"px-6 py-4 text-center text-gray-500",children:"No customers found"})}):l.map(e=>(0,s.jsxs)("tr",{className:"hover:bg-gray-50",children:[(0,s.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,s.jsxs)("div",{children:[(0,s.jsx)("div",{className:"text-sm font-medium text-gray-900",children:e.name}),(0,s.jsx)("div",{className:"text-sm text-gray-500",children:e.email})]})}),(0,s.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,s.jsx)("div",{className:"text-sm text-gray-900",children:e.phone})}),(0,s.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium",children:(0,s.jsx)("div",{className:"flex gap-2",children:(0,s.jsx)("button",{onClick:()=>e.id&&S(e.id),className:"text-red-600 hover:text-red-900",children:(0,s.jsx)(c.A,{className:"h-4 w-4"})})})})]},e.id))})]})})})]}),f&&(0,s.jsx)(F,{onImportComplete:()=>{v(!1),A(),C()},onClose:()=>v(!1)})]}):(0,s.jsx)("div",{className:"min-h-screen flex items-center justify-center",children:(0,s.jsxs)("div",{className:"text-center",children:[(0,s.jsx)("h2",{className:"text-2xl font-bold text-gray-900 mb-4",children:"Access Denied"}),(0,s.jsx)("p",{className:"text-gray-600",children:"Please log in to access the customer management system."})]})})}},646:(e,t,r)=>{"use strict";r.d(t,{A:()=>s});let s=(0,r(9946).A)("circle-check-big",[["path",{d:"M21.801 10A10 10 0 1 1 17 3.335",key:"yps3ct"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]])},2383:()=>{},2525:(e,t,r)=>{"use strict";r.d(t,{A:()=>s});let s=(0,r(9946).A)("trash-2",[["path",{d:"M10 11v6",key:"nco0om"}],["path",{d:"M14 11v6",key:"outv1u"}],["path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6",key:"miytrc"}],["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2",key:"e791ji"}]])},2657:(e,t,r)=>{"use strict";r.d(t,{A:()=>s});let s=(0,r(9946).A)("eye",[["path",{d:"M2.062 12.348a1 1 0 0 1 0-.696 10.75 10.75 0 0 1 19.876 0 1 1 0 0 1 0 .696 10.75 10.75 0 0 1-19.876 0",key:"1nclc0"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]])},3686:()=>{},4117:(e,t,r)=>{Promise.resolve().then(r.bind(r,570))},5339:(e,t,r)=>{"use strict";r.d(t,{A:()=>s});let s=(0,r(9946).A)("circle-alert",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]])},6104:(e,t,r)=>{"use strict";r.d(t,{Gg:()=>h,IG:()=>u,db:()=>d,j2:()=>m});var s=r(3915),a=r(1906),i=r(5317),n=r(7505),l=r(4903);let o={apiKey:"AIzaSyBYQA66rKOPrb4kce-hYCTYAbGKanVGbZ8",authDomain:"mirrorsbeautylounge-7c5ff.firebaseapp.com",projectId:"mirrorsbeautylounge-7c5ff",storageBucket:"mirrorsbeautylounge-7c5ff.firebasestorage.app",messagingSenderId:"1029530532506",appId:"1:1029530532506:web:2fa18cc521b2524e5afd23",measurementId:"G-GMWQSDP9JW"},c=null,d=null,u=null,m=null;function h(){return null!==c}!0;try{c=(0,s.initializeApp)(o),d=(0,i.aU)(c),u=(0,n.c7)(c),m=(0,l.getAuth)(c);try{(0,a.P5)(c)}catch(e){console.warn("Firebase Analytics initialization failed:",e)}}catch(e){console.error("Firebase initialization failed:",e),m=null}},7924:(e,t,r)=>{"use strict";r.d(t,{A:()=>s});let s=(0,r(9946).A)("search",[["path",{d:"m21 21-4.34-4.34",key:"14j7rj"}],["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}]])},9323:(e,t,r)=>{"use strict";r.d(t,{eg:()=>n,ej:()=>l,nW:()=>c,yN:()=>d});var s=r(4903),a=r(5317),i=r(6104);let n=async e=>{try{if(!i.j2)return{error:"Firebase auth is not initialized"};if(i.j2.currentUser){if(await (0,s.updateProfile)(i.j2.currentUser,{displayName:e}),!i.db)throw Error("Firestore is not initialized");let t=(0,a.H9)(i.db,"users",i.j2.currentUser.uid);await (0,a.mZ)(t,{displayName:e,updatedAt:new Date})}return{error:null}}catch(e){return console.error("Error updating profile:",e),{error:e instanceof Error?e.message:"Unknown error"}}},l=async e=>{try{if(!i.j2)return{error:"Firebase auth is not initialized"};return i.j2.currentUser&&await (0,s.f3)(i.j2.currentUser,e),{error:null}}catch(e){return console.error("Error updating password:",e),{error:e instanceof Error?e.message:"Unknown error"}}},o=async(e,t,r,s)=>{try{let n={uid:e,email:t,displayName:s,role:r,createdAt:new Date,updatedAt:new Date};if(!i.db)throw Error("Firestore is not initialized");return await (0,a.BN)((0,a.H9)(i.db,"users",e),n),{error:null}}catch(e){return{error:e instanceof Error?e.message:"Unknown error"}}},c=async()=>{try{if(!i.j2)return{success:!1,error:"Firebase auth is not initialized"};console.log("Creating admin user: admin@mirrorbeauty.com");let e=await (0,s.createUserWithEmailAndPassword)(i.j2,"admin@mirrorbeauty.com","admin123");return await (0,s.updateProfile)(e.user,{displayName:"Admin User"}),await o(e.user.uid,"admin@mirrorbeauty.com","admin","Admin User"),console.log("Admin user created successfully"),{success:!0,error:null}}catch(e){return console.error("Error creating admin user:",e),{success:!1,error:e instanceof Error?e.message:"Unknown error"}}},d=async(e,t,s,a)=>{try{if(console.log("Creating new user:",e),!(null===i.j2||void 0===i.j2?void 0:i.j2.currentUser))return{success:!1,error:"No authenticated user found"};let{initializeApp:n}=await Promise.resolve().then(r.bind(r,3915)),{getAuth:l,createUserWithEmailAndPassword:c,updateProfile:d,signOut:u}=await Promise.resolve().then(r.bind(r,4903)),m=n({apiKey:"AIzaSyBYQA66rKOPrb4kce-hYCTYAbGKanVGbZ8",authDomain:"mirrorsbeautylounge-7c5ff.firebaseapp.com",projectId:"mirrorsbeautylounge-7c5ff",storageBucket:"mirrorsbeautylounge-7c5ff.firebasestorage.app",messagingSenderId:"1029530532506",appId:"1:1029530532506:web:2fa18cc521b2524e5afd23",measurementId:"G-GMWQSDP9JW"},"secondary"),h=l(m),p=await c(h,e,t);s&&await d(p.user,{displayName:s}),await o(p.user.uid,e,a,s),await u(h);try{"delete"in m&&"function"==typeof m.delete&&await m.delete()}catch(e){console.log("Secondary app cleanup not needed or failed:",e)}return console.log("New user created successfully without affecting current session"),{success:!0,error:null,user:p.user}}catch(e){return console.error("Error creating new user:",e),{success:!1,error:e instanceof Error?e.message:"Unknown error"}}}},9946:(e,t,r)=>{"use strict";r.d(t,{A:()=>o});var s=r(2115);let a=e=>{let t=e.replace(/^([A-Z])|[\s-_]+(\w)/g,(e,t,r)=>r?r.toUpperCase():t.toLowerCase());return t.charAt(0).toUpperCase()+t.slice(1)},i=function(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];return t.filter((e,t,r)=>!!e&&""!==e.trim()&&r.indexOf(e)===t).join(" ").trim()};var n={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};let l=(0,s.forwardRef)((e,t)=>{let{color:r="currentColor",size:a=24,strokeWidth:l=2,absoluteStrokeWidth:o,className:c="",children:d,iconNode:u,...m}=e;return(0,s.createElement)("svg",{ref:t,...n,width:a,height:a,stroke:r,strokeWidth:o?24*Number(l)/Number(a):l,className:i("lucide",c),...!d&&!(e=>{for(let t in e)if(t.startsWith("aria-")||"role"===t||"title"===t)return!0})(m)&&{"aria-hidden":"true"},...m},[...u.map(e=>{let[t,r]=e;return(0,s.createElement)(t,r)}),...Array.isArray(d)?d:[d]])}),o=(e,t)=>{let r=(0,s.forwardRef)((r,n)=>{let{className:o,...c}=r;return(0,s.createElement)(l,{ref:n,iconNode:t,className:i("lucide-".concat(a(e).replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase()),"lucide-".concat(e),o),...c})});return r.displayName=a(e),r}}},e=>{e.O(0,[135,210,524,748,441,964,358],()=>e(e.s=4117)),_N_E=e.O()}]);